/*
 * S6 1.0 - 3D Mobile Touch Slider (Minified Version)
 * http://www.idangero.us/sliders/s6/
 *
 * Copyright 2012, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under iDangero.us Regular License (RL):
 * http://www.idangero.us/index.php?content=article&id=21
 *
 * Released on: April 1, 2012
*/
(function(i){i.fn.s6=function(b){function r(){var a=document.createElement("div");a.id="test3d";var b=!1;"webkitPerspective"in a.style&&(b=!0);"MozPerspective"in a.style&&(b=!0);"OPerspective"in a.style&&(b=!0);"MsPerspective"in a.style&&(b=!0);"perspective"in a.style&&(b=!0);if(b&&"webkitPerspective"in a.style){var g=document.createElement("style");g.textContent="@media (-webkit-transform-3d), (transform-3d), (-moz-transform-3d), (-o-transform-3d), (-ms-transform-3d) {#test3d{height:5px}}";document.getElementsByTagName("head")[0].appendChild(g);document.body.appendChild(a);b=5===a.offsetHeight;g.parentNode.removeChild(g);a.parentNode.removeChild(a)}return b}function e(){return"horizontal"==a.params.mode}function o(){if(e()){var c=90*Math.round(d().y/90);j({y:c},!0,!0);a.rotates.currentY=c}else c=90*Math.round(d().x/90),j({x:c},!0,!0),a.rotates.currentX=c;if(b.onSlideReset)b.onSlideReset(a)}function s(c){var b=a.wrapper[0],g=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd"];if(c)for(var f=function(){c(a);for(var e=0;e<g.length;e++)b.removeEventListener(g[e],f,!1)},e=0;e<g.length;e++)b.addEventListener(g[e],f,!1)}function t(){var c=e()?d().y:d().x,c=c-360*Math.floor(c/360),c=4-c/90,c=4==c?0:c,b;0==c&&(b=i(".s6-slide-front"));1==c&&(e()?b=i(".s6-slide-right"):b=i(".s6-slide-top"));2==c&&(b=i(".s6-slide-back"));3==c&&(e()?b=i(".s6-slide-left"):b=i(".s6-slide-bottom"));a.wrapper.find(".s6-slide-active").removeClass("s6-slide-active");b.addClass("s6-slide-active")}function j(c,l,g){g||(g=!1);c||(c={});c.x=c.x||0;c.y=c.y||0;c.z=c.z||0;var f;if(e()){var d=a.width*Math.sin(2*c.y*Math.PI/360)/2,j=a.width*Math.cos(2*c.y*Math.PI/360)/2-a.width/2;Math.round(d)}e()?(d=a.width*Math.sin(2*c.y*Math.PI/360)/2,f=0,j=a.width*Math.cos(2*c.y*Math.PI/360)/2-a.width/2,d=Math.round(d)):(d=0,f=-a.height*Math.sin(2*c.x*Math.PI/360)/2,j=a.height*Math.cos(2*c.x*Math.PI/360)/2-a.height/2,f=Math.round(f));f||(f=0);var h=a.wrapper[0].style;h.webkitTransform=h.MsTransform=h.MozTransform=h.OTransform=h.transform="translate3d("+d+"px,  "+f+"px,"+j+"px) rotateX("+c.x+"deg) rotateY("+c.y+"deg)";!e()&&a.params.dynamicShadow&&(f=Math.abs(c.x),f-=90*Math.floor(f/90),f=1.5-(Math.sin(2*f*Math.PI/360)/2+Math.cos(2*f*Math.PI/360)/2),f=a.params.dynamicShadowScale/f,d=a.shadow[0].style,d.webkitTransform=d.MsTransform=d.MozTransform=d.OTransform=d.transform="scale3d("+b.dynamicShadowScale+", 1, "+f+") translate3d(0px, "+(a.height/2+a.params.dynamicShadowOffset)+"px, "+-a.height/2/f+"px) rotateX(-90deg)");l&&a.wrapper.attr({"data-s6rotatex":c.x,"data-s6rotatey":c.y,"data-s6rotatez":c.z});if(a.params.freeMode||g)if(l=a,g=c.x,c=c.y,c="horizontal"==a.params.mode?c:-g,0<c?(g=Math.floor(c/360),c=4-Math.round((c-360*g)/90)):(g=Math.floor(-c/360),c=Math.round(-(c+360*g)/90)),4==c&&(c=0),l.activeSlide=c,a.params.pagination)c=i(a.params.pagination).find("."+a.params.paginationActiveClass).index(),l=a.activeSlide,c!=l&&(i(a.params.pagination).find("."+a.params.paginationActiveClass).removeClass(a.params.paginationActiveClass),i(a.params.pagination).children().eq(l).addClass(a.params.paginationActiveClass))}function d(){return{x:a.wrapper.attr("data-s6rotatex"),y:a.wrapper.attr("data-s6rotatey"),z:a.wrapper.attr("data-s6rotatez")}}function m(c){var b=a.wrapper[0].style;b.webkitTransitionDuration=b.MsTransitionDuration=b.MozTransitionDuration=b.OTransitionDuration=b.transitionDuration=c/1E3+"s";!e()&&a.params.dynamicShadow&&(b=a.shadow[0].style,b.webkitTransitionDuration=b.MsTransitionDuration=b.MozTransitionDuration=b.OTransitionDuration=b.transitionDuration=c/1E3+"s")}var h=i(this);if(0==h.length)return h;b=b||{};b.speed=b.speed||500;b.simulateTouch=!1===b.simulateTouch?!1:!0;b.freeMode=b.freeMode||!1;b.perspective=b.perspective||1E3;b.mode=b.mode||"horizontal";b.slideClass=b.slideClass||"s6-slide";b.wrapperClass=b.wrapperClass||"s6-wrapper";b.paginationClass=b.paginationClass||"s6-pagination-switch";b.paginationActiveClass=b.paginationActiveClass||"s6-active-switch";b.autoPlay=b.autoPlay||!1;b.followFinger=!1===b.followFinger?!1:!0;b.createBackFaces=!1===b.createBackFaces?!1:!0;b.createPagination=!1===b.createPagination?!1:!0;!1!==b.setPerspective&&!0!==b.setPerspective&&(b.setPerspective=!0);b.dynamicShadow=b.dynamicShadow||!1;b.dynamicShadowOffset=b.dynamicShadowOffset||20;b.dynamicShadowScale=b.dynamicShadowScale||0.9;var k;if(!(0<h.find(".s6-slide-top").length)){if(!r()&&window.Swiper)return h.css({overflow:"hidden"}),h.find("."+b.slideClass).css("float","left").css("position","relative"),new Swiper(h.selector,b);b.faces=b.faces||{};b.faces.left=b.faces.left||"#555";b.faces.right=b.faces.right||"#888";b.faces.top=b.faces.top||"#888";b.faces.bottom=b.faces.bottom||"#555";var a={container:h,wrapper:h.find("."+b.wrapperClass),slides:h.find("."+b.slideClass),params:b,touches:{},rotates:{},times:{},isSupport3D:r(),init:function(){a.width=h.width();a.height=h.height();a.wrapper.css({width:a.width,height:a.height});a.wrapper.find("."+b.slideClass).css({width:a.width,height:a.height})}};a.init();!0===a.params.setPerspective&&a.container.css({"-webkit-perspective":a.params.perspective,"-moz-perspective":a.params.perspective,"-ms-perspective":a.params.perspective,"-o-perspective":a.params.perspective,perspective:a.params.perspective});a.wrapper.find("."+b.slideClass).css({width:a.width,height:a.height});a.setSlides=function(){a.slides.each(function(){i(this).removeClass("s6-slide-top").removeClass("s6-slide-left").removeClass("s6-slide-right").removeClass("s6-slide-bottom").removeClass("s6-slide-front").removeClass("s6-slide-back")});a.slides.eq(0).addClass("s6-slide-front");a.slides.eq(2).addClass("s6-slide-back");if(e()){a.slides.eq(1).addClass("s6-slide-right");a.slides.eq(3).addClass("s6-slide-left")}else{a.slides.eq(1).addClass("s6-slide-bottom");a.slides.eq(3).addClass("s6-slide-top")}a.slides.each(function(){var c=i(this),b=c[0].style;if(c.hasClass("s6-slide-right"))b.webkitTransform=b.MsTransform=b.MozTransform=b.OTransform=b.transform="translate3d("+a.width/2+"px, 0px, "+-a.width/2+"px) rotateY(90deg)";if(c.hasClass("s6-slide-left"))b.webkitTransform=b.MsTransform=b.MozTransform=b.OTransform=b.transform="translate3d("+-a.width/2+"px, 0px, "+-a.width/2+"px) rotateY(-90deg)";if(c.hasClass("s6-slide-back"))b.webkitTransform=e()?b.MsTransform=b.MozTransform=b.OTransform=b.transform="translate3d(0px, 0px, "+-a.width+"px) rotateY(180deg)":b.MsTransform=b.MozTransform=b.OTransform=b.transform="translate3d(0px, 0px, "+-a.height+"px) rotateY(180deg) rotateZ(180deg)";if(c.hasClass("s6-slide-top"))b.webkitTransform=b.MsTransform=b.MozTransform=b.OTransform=b.transform="translate3d(0px, "+-a.height/2+"px, "+-a.height/2+"px) rotateX(90deg)";if(c.hasClass("s6-slide-bottom"))b.webkitTransform=b.MsTransform=b.MozTransform=b.OTransform=b.transform="translate3d(0px, "+a.height/2+"px, "+-a.height/2+"px) rotateX(-90deg)"});if(a.params.dynamicShadow){a.container.find(".s6-dynamic-shadow").length>0&&a.container.find(".s6-dynamic-shadow").remove();var c=a.params.dynamicShadowScale,d=a.params.dynamicShadowOffset;e()?a.wrapper.append('<div class="s6-dynamic-shadow"></div>'):a.container.append('<div class="s6-dynamic-shadow"></div>');a.shadow=a.container.find(".s6-dynamic-shadow");c=e()?"scale3d("+c+", 1, "+c+") translate3d(0px, "+(a.height-a.width/2+d)+"px, "+-a.width/2/c+"px) rotateX(-90deg)":"scale3d("+c+", 1, "+c+") translate3d(0px, "+(a.height/2+d)+"px, "+-a.height/2/c+"px) rotateX(-90deg)";d=a.shadow[0].style;d.webkitTransform=d.MsTransform=d.MozTransform=d.OTransform=d.transform=c;d.width=a.width+"px";d.height=(e()?a.width:a.height)+"px"}if(e()){if(a.params.createBackFaces){a.wrapper.find(".s6-slide-top, .s6-slide-bottom").remove();a.wrapper.append('<div class="'+a.params.slideClass+' s6-slide-top"></div><div class="'+a.params.slideClass+' s6-slide-bottom"></div>');a.wrapper.find(".s6-slide-top").css({width:a.width,height:a.width,background:b.faces.top});c=a.wrapper.find(".s6-slide-top")[0].style;c.webkitTransform=c.MsTransform=c.MozTransform=c.OTransform=c.transform="translate3d(0px, "+-a.width/2+"px, "+-a.width/2+"px) rotateX(90deg)";a.wrapper.find(".s6-slide-bottom").css({width:a.width,height:a.width,background:b.faces.bottom});c=a.wrapper.find(".s6-slide-bottom")[0].style;c.webkitTransform=c.MsTransform=c.MozTransform=c.OTransform=c.transform="translate3d(0px, "+(a.height-a.width/2)+"px, "+-a.width/2+"px) rotateX(-90deg)"}}else if(a.params.createBackFaces){a.wrapper.find(".s6-slide-left, .s6-slide-right").remove();a.wrapper.append('<div class="'+a.params.slideClass+' s6-slide-left"></div><div class="'+a.params.slideClass+' s6-slide-right"></div>');a.wrapper.find(".s6-slide-left").css({width:a.height,height:a.height,background:b.faces.left});c=a.wrapper.find(".s6-slide-left")[0].style;c.webkitTransform=c.MsTransform=c.MozTransform=c.OTransform=c.transform="translate3d("+-a.height/2+"px, 0px, "+-a.height/2+"px) rotateY(-90deg)";a.wrapper.find(".s6-slide-right").css({width:a.height,height:a.height,background:b.faces.right});c=a.wrapper.find(".s6-slide-right")[0].style;c.webkitTransform=c.MsTransform=c.MozTransform=c.OTransform=c.transform="translate3d("+(a.width-a.height/2)+"px, 0px, "+-a.height/2+"px) rotateY(90deg)"}};a.setSlides();i(window).resize(function(){a.init();a.setSlides()});a.wrapper.find(".s6-slide-front").addClass("s6-slide-active");a.activeSlide=0;if(!1!=a.params.pagination){if(a.params.createPagination){for(var n="",p=1;p<=a.slides.length;p++)n+='<span class="'+a.params.paginationClass+'"></span>';i(a.params.pagination).html(n)}i(a.params.pagination).children().eq(0).addClass(a.params.paginationActiveClass)}a.isSupportTouch=function(){return"ontouchstart"in window};var n=a.isSupportTouch()||!a.params.simulateTouch?"touchstart":"mousedown",p=a.isSupportTouch()||!a.params.simulateTouch?"touchmove":"mousemove",u=a.isSupportTouch()||!a.params.simulateTouch?"touchend":"mouseup",q;a.startAutoPlay=function(){a.params.autoPlay&&(q=setInterval(function(){a.swipeNext()},a.params.autoPlay))};a.stopAutoPlay=function(){q&&clearInterval(q)};a.params.autoPlay&&a.startAutoPlay();a.container[0].addEventListener(n,function(c){if(a.isTouched)return false;a.isTouched=true;if(!a.params.onlyExternal&&(!a.isSupportTouch()||c.targetTouches.length==1)){!a.isSupportTouch()&&a.params.simulateTouch&&c.preventDefault();a.touches.startX=a.isSupportTouch()?c.targetTouches[0].pageX:c.pageX;a.touches.startY=a.isSupportTouch()?c.targetTouches[0].pageY:c.pageY;m(0);a.rotates.startX=a.rotates.currentX=d().x;a.rotates.startY=a.rotates.currentY=d().y;a.times.start=(new Date).getTime();k=void 0;if(b.onTouchStart)b.onTouchStart(a)}});a.container[0].addEventListener(p,function(c){if(a.isTouched)a:if(!a.params.onlyExternal){if(a.isSupportTouch()){typeof k=="undefined"&&e()&&(k=!!(k||Math.abs(c.targetTouches[0].pageY-a.touches.startY)>Math.abs(c.targetTouches[0].pageX-a.touches.startX)));typeof k=="undefined"&&!e()&&(k=!!(k||Math.abs(c.targetTouches[0].pageY-a.touches.startY)<Math.abs(c.targetTouches[0].pageX-a.touches.startX)));if(k)break a}a.params.autoPlay&&a.stopAutoPlay();if(!a.isSupportTouch()||c.touches.length==1){c.preventDefault();a.isSupportTouch();a.touches.currentX=a.isSupportTouch()?c.targetTouches[0].pageX:c.pageX;a.touches.currentY=a.isSupportTouch()?c.targetTouches[0].pageY:c.pageY;a.touches.diffX=a.touches.currentX-a.touches.startX;a.touches.diffY=a.touches.currentY-a.touches.startY;a.rotates.currentX=(!e()?a.touches.diffY*(-90/a.height):0)+a.rotates.startX*1;a.rotates.currentY=(e()?a.touches.diffX*90/a.width:0)+a.rotates.startY*1;b.followFinger&&j({x:a.rotates.currentX,y:a.rotates.currentY},false);if(b.onTouchMove)b.onTouchMove(a)}}});a.container[0].addEventListener(u,function(){a.isTouched=false;if(!a.params.onlyExternal){j({x:a.rotates.currentX,y:a.rotates.currentY},true);m(a.params.speed);if(!a.rotates.currentY)a.rotates.currentY=a.rotates.startY;if(!a.rotates.currentX)a.rotates.currentX=a.rotates.startX;a.rotates.diffY=a.rotates.currentY-a.rotates.startY;a.rotates.diffX=a.rotates.currentX-a.rotates.startX;a.times.end=(new Date).getTime();if(a.params.freeMode){if(a.times.end-a.times.start<300&&a.params.freeModeFluid==true)if(e()){if(Math.abs(a.rotates.diffY)!==0){j({y:a.rotates.currentY*1+a.rotates.diffY*1},true);m((a.times.end-a.times.start)*3)}}else if(Math.abs(a.rotates.diffX)!==0){j({x:a.rotates.currentX*1+a.rotates.diffX*1},true);m((a.times.end-a.times.start)*3)}}else{a.rotates.diff=e()?a.rotates.diffY:a.rotates.diffX;a.direction=e()?a.rotates.diffY<0?"toRight":"toLeft":a.rotates.diffX>0?"toRight":"toLeft";a.direction=="toRight"&&a.times.end-a.times.start<=500&&(Math.abs(a.rotates.diff)<10?o():a.swipeNext());a.direction=="toLeft"&&a.times.end-a.times.start<=500&&(Math.abs(a.rotates.diff)<10?o():a.swipePrev());a.direction=="toRight"&&a.times.end-a.times.start>500&&(Math.abs(a.rotates.diff)>=45?a.swipeNext():o());a.direction=="toLeft"&&a.times.end-a.times.start>500&&(Math.abs(a.rotates.diff)>=45?a.swipePrev():o())}if(b.onTouchEnd)b.onTouchEnd(a)}});j({x:0,y:0,z:0},!0);a.swipeNext=function(){if(e()){var c=Math.ceil(d().y/90)*90-90;j({y:c},true,true);a.rotates.currentY=c}else{c=Math.ceil(d().x/90)==d().x/90?90:0;c=Math.ceil(d().x/90)*90+c;j({x:c},true,true);a.rotates.currentX=c}t();m(a.params.speed);if(b.onSlideChangeStart)b.onSlideChangeStart(a);b.onSlideChangeEnd&&s(b.onSlideChangeEnd)};a.swipePrev=function(){if(e()){var c=Math.floor(d().y/90)*90+90;j({y:c},true,true);a.rotates.currentY=c}else{c=Math.ceil(d().x/90)==d().x/90?-90:0;c=Math.floor(d().x/90)*90+c;j({x:c},true,true);a.rotates.currentX=c}t();m(a.params.speed);if(b.onSlideChangeStart)b.onSlideChangeStart(a);b.onSlideChangeEnd&&s(b.onSlideChangeEnd)};return a}}})(window.jQuery||window.Zepto);