/*
 * S6 1.2 - 3D Mobile Touch Slider
 * http://www.idangero.us/sliders/s6/
 *
 * Copyright 2012, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under iDangero.us Regular License (RL):
 * http://www.idangero.us/index.php?content=article&id=21
 *
 * Updated on: April 11, 2012
*/
(function(l){l.fn.s6=function(b){function w(){var a=document.createElement("div");a.id="test3d";var f=!1;"webkitPerspective"in a.style&&(f=!0);"MozPerspective"in a.style&&(f=!0);"OPerspective"in a.style&&(f=!0);"MsPerspective"in a.style&&(f=!0);"perspective"in a.style&&(f=!0);if(f&&"webkitPerspective"in a.style){var b=document.createElement("style");b.textContent="@media (-webkit-transform-3d), (transform-3d), (-moz-transform-3d), (-o-transform-3d), (-ms-transform-3d) {#test3d{height:5px}}";document.getElementsByTagName("head")[0].appendChild(b);document.body.appendChild(a);f=5===a.offsetHeight;b.parentNode.removeChild(b);a.parentNode.removeChild(a)}return f}function e(){return"horizontal"==a.params.mode}function d(c,b){var n="";switch(b){case "front":n="translate3d(0px, 0px, 0px) rotateY(0deg)";break;case "right":n=e()?"translate3d("+a.width/2+"px, 0px, "+-a.width/2+"px) rotateY(90deg)":"translate3d("+(a.width-a.height/2)+"px, 0px, "+-a.height/2+"px) rotateY(90deg)";break;case "back":n=e()?"translate3d(0px, 0px, "+-a.width+"px) rotateY(180deg)":"translate3d(0px, 0px, "+-a.height+"px) rotateX(180deg)";break;case "left":n=e()?"translate3d("+-a.width/2+"px, 0px, "+-a.width/2+"px) rotateY(-90deg)":"translate3d("+-a.height/2+"px, 0px, "+-a.height/2+"px) rotateY(-90deg)";break;case "top":n=e()?"translate3d(0px, "+-a.width/2+"px, "+-a.width/2+"px) rotateX(90deg)":"translate3d(0px, "+-a.height/2+"px, "+-a.height/2+"px) rotateX(90deg)";break;case "bottom":n=e()?"translate3d(0px, "+(a.height-a.width/2)+"px, "+-a.width/2+"px) rotateX(-90deg)":"translate3d(0px, "+a.height/2+"px, "+-a.height/2+"px) rotateX(-90deg)"}var g=c.style;g.webkitTransform=g.MsTransform=g.MozTransform=g.OTransform=g.transform=n}function t(){var c=e()?j().y:j().x,b=Math.abs(c),b=b-360*Math.floor(b/360),n=a.activeSlide+1>=a.numOfSlides?0:a.activeSlide+1,g=0>a.activeSlide-1?a.numOfSlides-1:a.activeSlide-1,h=a.slides.eq(n),i=h[0],k=a.slides.eq(g),o=k[0];a.slides.each(function(){var c=l(this).index();c!=n&&c!=g&&c!=a.activeSlide&&l(this).hide()});if(e()){0==b&&(d(i,"right"),d(o,"left"));if(90==b||270==b&&0<c)d(i,"back"),d(o,"front");180===b&&(d(i,"left"),d(o,"right"));if(270===b&&0>c||90==b&&0<c)d(i,"front"),d(o,"back")}else{0==b&&(d(i,"bottom"),d(o,"top"));if(90==b||270==b&&0>c)d(i,"back"),d(o,"front");180===b&&(d(i,"top"),d(o,"bottom"));if(270===b&&0<c||90==b&&0>c)d(i,"front"),d(o,"back")}h.show();k.show()}function x(){a.init();a.setSlides();r(!0)}function y(c){if(a.isTouched)return!1;a.isTouched=!0;a.inf&&t();if(!a.params.onlyExternal&&(!a.isSupportTouch()||1==c.targetTouches.length))if(!a.isSupportTouch()&&a.params.simulateTouch&&c.preventDefault(),a.touches.startX=a.isSupportTouch()?c.targetTouches[0].pageX:c.pageX,a.touches.startY=a.isSupportTouch()?c.targetTouches[0].pageY:c.pageY,q(0),a.rotates.startX=a.rotates.currentX=j().x,a.rotates.startY=a.rotates.currentY=j().y,a.times.start=(new Date).getTime(),p=void 0,b.onTouchStart)b.onTouchStart(a)}function z(c){if(a.isTouched&&!a.params.onlyExternal){if(a.isSupportTouch()&&("undefined"==typeof p&&e()&&(p=!!(p||Math.abs(c.targetTouches[0].pageY-a.touches.startY)>Math.abs(c.targetTouches[0].pageX-a.touches.startX))),"undefined"==typeof p&&!e()&&(p=!!(p||Math.abs(c.targetTouches[0].pageY-a.touches.startY)<Math.abs(c.targetTouches[0].pageX-a.touches.startX))),p))return;a.params.autoPlay&&a.stopAutoPlay();if(!a.isSupportTouch()||1==c.touches.length){c.preventDefault();a.isSupportTouch();a.touches.currentX=a.isSupportTouch()?c.targetTouches[0].pageX:c.pageX;a.touches.currentY=a.isSupportTouch()?c.targetTouches[0].pageY:c.pageY;a.touches.diffX=a.touches.currentX-a.touches.startX;a.touches.diffY=a.touches.currentY-a.touches.startY;var c=(!e()?a.touches.diffY*(-90/a.height):0)+1*a.rotates.startX,f=(e()?90*a.touches.diffX/a.width:0)+1*a.rotates.startY;if(a.inf)if(e()){if(90<=Math.abs(f-a.rotates.startY))return}else if(90<=Math.abs(c-a.rotates.startX))return;a.rotates.currentX=c;a.rotates.currentY=f;b.followFinger&&k({x:a.rotates.currentX,y:a.rotates.currentY},!1);if(b.onTouchMove)b.onTouchMove(a)}}}function A(){if(a.isTouched&&(a.isTouched=!1,!a.params.onlyExternal))if(k({x:a.rotates.currentX,y:a.rotates.currentY},!0),q(a.params.speed),a.rotates.currentY||(a.rotates.currentY=a.rotates.startY),a.rotates.currentX||(a.rotates.currentX=a.rotates.startX),a.rotates.diffY=a.rotates.currentY-a.rotates.startY,a.rotates.diffX=a.rotates.currentX-a.rotates.startX,a.times.end=(new Date).getTime(),a.params.freeMode&&!a.inf?300>a.times.end-a.times.start&&!0==a.params.freeModeFluid&&(e()?0!==Math.abs(a.rotates.diffY)&&(k({y:1*a.rotates.currentY+1*a.rotates.diffY},!0),q(3*(a.times.end-a.times.start))):0!==Math.abs(a.rotates.diffX)&&(k({x:1*a.rotates.currentX+1*a.rotates.diffX},!0),q(3*(a.times.end-a.times.start)))):(a.rotates.diff=e()?a.rotates.diffY:a.rotates.diffX,a.direction=e()?0>a.rotates.diffY?"toRight":"toLeft":0<a.rotates.diffX?"toRight":"toLeft","toRight"==a.direction&&500>=a.times.end-a.times.start&&(10>Math.abs(a.rotates.diff)?r():a.swipeNext("internal")),"toLeft"==a.direction&&500>=a.times.end-a.times.start&&(10>Math.abs(a.rotates.diff)?r():a.swipePrev("internal")),"toRight"==a.direction&&500<a.times.end-a.times.start&&(45<=Math.abs(a.rotates.diff)?a.swipeNext("internal"):r()),"toLeft"==a.direction&&500<a.times.end-a.times.start&&(45<=Math.abs(a.rotates.diff)?a.swipePrev("internal"):r())),b.onTouchEnd)b.onTouchEnd(a)}function r(c){if(e()){var f=90*Math.round(j().y/90);k({y:f},!0,!0);a.rotates.currentY=f}else f=90*Math.round(j().x/90),k({x:f},!0,!0),a.rotates.currentX=f;c&&q(0);if(b.onSlideReset)b.onSlideReset(a)}function B(c){var b=a.wrapper[0],e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd"];if(c)for(var g=function(){c(a);for(var d=0;d<e.length;d++)b.removeEventListener(e[d],g,!1)},d=0;d<e.length;d++)b.addEventListener(e[d],g,!1)}function C(){if(a.inf)var c=a.wrapper.slides.eq(a.activeSlide);else{var b=e()?j().y:j().x,b=b-360*Math.floor(b/360),b=4-b/90,b=4==b?0:b;0==b&&(c=a.wrapper.find(".s6-slide-front"));1==b&&(e()?c=a.wrapper.find(".s6-slide-right"):c=a.wrapper.find(".s6-slide-top"));2==b&&(c=a.wrapper.find(".s6-slide-back"));3==b&&(e()?c=a.wrapper.find(".s6-slide-left"):c=a.wrapper.find(".s6-slide-bottom"))}a.wrapper.find(".s6-slide-active").removeClass("s6-slide-active");c.addClass("s6-slide-active")}function k(c,f,d,g){d||(d=!1);c||(c={});c.x=c.x||0;c.y=c.y||0;c.z=c.z||0;var h;if(e()){var i=a.width*Math.sin(2*c.y*Math.PI/360)/2,j=a.width*Math.cos(2*c.y*Math.PI/360)/2-a.width/2;Math.round(i)}e()?(i=a.width*Math.sin(2*c.y*Math.PI/360)/2,h=0,j=a.width*Math.cos(2*c.y*Math.PI/360)/2-a.width/2,i=Math.round(i)):(i=0,h=-a.height*Math.sin(2*c.x*Math.PI/360)/2,j=a.height*Math.cos(2*c.x*Math.PI/360)/2-a.height/2,h=Math.round(h));h||(h=0);var k=a.wrapper[0].style;k.webkitTransform=k.MsTransform=k.MozTransform=k.OTransform=k.transform="translate3d("+i+"px,  "+h+"px,"+j+"px) rotateX("+c.x+"deg) rotateY("+c.y+"deg)";!e()&&a.params.dynamicShadow&&(h=Math.abs(c.x),h-=90*Math.floor(h/90),h=1.5-(Math.sin(2*h*Math.PI/360)/2+Math.cos(2*h*Math.PI/360)/2),h=a.params.dynamicShadowScale/h,i=a.shadow[0].style,i.webkitTransform=i.MsTransform=i.MozTransform=i.OTransform=i.transform="scale3d("+b.dynamicShadowScale+", 1, "+h+") translate3d(0px, "+(a.height/2+a.params.dynamicShadowOffset)+"px, "+-a.height/2/h+"px) rotateX(-90deg)");f&&a.wrapper.attr({"data-s6rotatex":c.x,"data-s6rotatey":c.y,"data-s6rotatez":c.z});if(a.params.freeMode||d)if(f=a,d=c.x,c=c.y,a.inf?g?(c=a.activeSlide+1>=a.numOfSlides?0:a.activeSlide+1,d=0>a.activeSlide-1?a.numOfSlides-1:a.activeSlide-1,g="next"==g?c:d,a.activeSlide=g):g=a.activeSlide:(g="horizontal"==a.params.mode?c:-d,0<g?(c=Math.floor(g/360),g=4-Math.round((g-360*c)/90)):(c=Math.floor(-g/360),g=Math.round(-(g+360*c)/90)),4==g&&(g=0)),f.activeSlide=g,a.params.pagination)g=l(a.params.pagination).find("."+a.params.paginationActiveClass).index(),c=a.activeSlide,g!=c&&(l(a.params.pagination).find("."+a.params.paginationActiveClass).removeClass(a.params.paginationActiveClass),l(a.params.pagination).children().eq(c).addClass(a.params.paginationActiveClass))}function j(){return{x:a.wrapper.attr("data-s6rotatex"),y:a.wrapper.attr("data-s6rotatey"),z:a.wrapper.attr("data-s6rotatez")}}function q(c){var b=a.wrapper[0].style;b.webkitTransitionDuration=b.MsTransitionDuration=b.MozTransitionDuration=b.OTransitionDuration=b.transitionDuration=c/1E3+"s";!e()&&a.params.dynamicShadow&&(b=a.shadow[0].style,b.webkitTransitionDuration=b.MsTransitionDuration=b.MozTransitionDuration=b.OTransitionDuration=b.transitionDuration=c/1E3+"s")}var m=l(this);if(0==m.length)return m;b=b||{};b.speed=b.speed||500;b.simulateTouch=!1===b.simulateTouch?!1:!0;b.freeMode=b.freeMode||!1;b.perspective=b.perspective||1E3;b.mode=b.mode||"horizontal";b.slideClass=b.slideClass||"s6-slide";b.wrapperClass=b.wrapperClass||"s6-wrapper";b.paginationClass=b.paginationClass||"s6-pagination-switch";b.paginationActiveClass=b.paginationActiveClass||"s6-active-switch";b.autoPlay=b.autoPlay||!1;b.followFinger=!1===b.followFinger?!1:!0;b.createBackFaces=!1===b.createBackFaces?!1:!0;b.createPagination=!1===b.createPagination?!1:!0;!1!==b.setPerspective&&!0!==b.setPerspective&&(b.setPerspective=!0);b.dynamicShadow=b.dynamicShadow||!1;b.dynamicShadowOffset=b.dynamicShadowOffset||20;b.dynamicShadowScale=b.dynamicShadowScale||0.9;var p;if(!(0<m.find(".s6-slide-top").length)){if(!w()&&window.Swiper)return m.css({overflow:"hidden"}),m.find("."+b.slideClass).css("float","left").css("position","relative").css("visibility","visible"),new Swiper(m.selector,b);b.faces=b.faces||{};b.faces.left=b.faces.left||"#555";b.faces.right=b.faces.right||"#888";b.faces.top=b.faces.top||"#888";b.faces.bottom=b.faces.bottom||"#555";var a={container:m,wrapper:m.find("."+b.wrapperClass),slides:m.find("."+b.slideClass),params:b,touches:{},rotates:{},times:{},isSupport3D:w(),activeSlide:0,init:function(){a.width=m.width();a.height=m.height();a.wrapper.css({width:a.width,height:a.height});a.wrapper.find("."+b.slideClass).css({width:a.width,height:a.height})}};a.init();!0===a.params.setPerspective&&a.container.css({"-webkit-perspective":a.params.perspective,"-moz-perspective":a.params.perspective,"-ms-perspective":a.params.perspective,"-o-perspective":a.params.perspective,perspective:a.params.perspective});a.wrapper.find("."+b.slideClass).css({width:a.width,height:a.height});a.numOfSlides=a.wrapper.find(".s6-slide").length;a.inf=4<a.numOfSlides?!0:!1;a.inf&&a.slides.not(":eq(0)").hide();a.setSlides=function(){a.slides.each(function(){l(this).removeClass("s6-slide-top").removeClass("s6-slide-left").removeClass("s6-slide-right").removeClass("s6-slide-bottom").removeClass("s6-slide-front").removeClass("s6-slide-back")});if(a.inf)a.slides.eq(0).addClass("s6-slide-front");else{a.slides.eq(0).addClass("s6-slide-front");a.slides.eq(2).addClass("s6-slide-back");if(e()){a.slides.eq(1).addClass("s6-slide-right");a.slides.eq(3).addClass("s6-slide-left")}else{a.slides.eq(1).addClass("s6-slide-bottom");a.slides.eq(3).addClass("s6-slide-top")}}a.slides.each(function(){if(!a.inf){var b=l(this),c=b[0];b.hasClass("s6-slide-right")&&d(c,"right");b.hasClass("s6-slide-left")&&d(c,"left");b.hasClass("s6-slide-back")&&d(c,"back");b.hasClass("s6-slide-top")&&d(c,"top");b.hasClass("s6-slide-bottom")&&d(c,"bottom")}});if(a.params.dynamicShadow){a.container.find(".s6-dynamic-shadow").length>0&&a.container.find(".s6-dynamic-shadow").remove();var c=a.params.dynamicShadowScale,f=a.params.dynamicShadowOffset;e()?a.wrapper.append('<div class="s6-dynamic-shadow"></div>'):a.container.append('<div class="s6-dynamic-shadow"></div>');a.shadow=a.container.find(".s6-dynamic-shadow");c=e()?"scale3d("+c+", 1, "+c+") translate3d(0px, "+(a.height-a.width/2+f)+"px, "+-a.width/2/c+"px) rotateX(-90deg)":"scale3d("+c+", 1, "+c+") translate3d(0px, "+(a.height/2+f)+"px, "+-a.height/2/c+"px) rotateX(-90deg)";f=a.shadow[0].style;f.webkitTransform=f.MsTransform=f.MozTransform=f.OTransform=f.transform=c;f.width=a.width+"px";f.height=(e()?a.width:a.height)+"px"}if(e()){if(a.params.createBackFaces){a.wrapper.find(".s6-slide-top, .s6-slide-bottom").remove();a.wrapper.append('<div class="'+a.params.slideClass+' s6-slide-top"></div><div class="'+a.params.slideClass+' s6-slide-bottom"></div>');a.wrapper.find(".s6-slide-top").css({width:a.width,height:a.width,background:b.faces.top});c=a.wrapper.find(".s6-slide-top")[0];d(c,"top");a.wrapper.find(".s6-slide-bottom").css({width:a.width,height:a.width,background:b.faces.bottom});c=a.wrapper.find(".s6-slide-bottom")[0];d(c,"bottom")}}else if(a.params.createBackFaces){a.wrapper.find(".s6-slide-left, .s6-slide-right").remove();a.wrapper.append('<div class="'+a.params.slideClass+' s6-slide-left"></div><div class="'+a.params.slideClass+' s6-slide-right"></div>');a.wrapper.find(".s6-slide-left").css({width:a.height,height:a.height,background:b.faces.left});c=a.wrapper.find(".s6-slide-left")[0];d(c,"left");a.wrapper.find(".s6-slide-right").css({width:a.height,height:a.height,background:b.faces.right});c=a.wrapper.find(".s6-slide-right")[0];d(c,"right")}};a.setSlides();a.wrapper.find("."+a.params.slideClass).css({visibility:"visible"});l(window).resize(function(){a.init();a.setSlides()});window.addEventListener("resize",x,!1);a.wrapper.find(".s6-slide-front").addClass("s6-slide-active");if(!1!=a.params.pagination){if(a.params.createPagination){for(var u="",D=1;D<=a.slides.length;D++)u+='<span class="'+a.params.paginationClass+'"></span>';l(a.params.pagination).html(u)}l(a.params.pagination).children().eq(0).addClass(a.params.paginationActiveClass)}a.isSupportTouch=function(){return"ontouchstart"in window};var E=a.isSupportTouch()||!a.params.simulateTouch?"touchstart":"mousedown",F=a.isSupportTouch()||!a.params.simulateTouch?"touchmove":"mousemove",G=a.isSupportTouch()||!a.params.simulateTouch?"touchend":"mouseup",v;a.startAutoPlay=function(){a.params.autoPlay&&(v=setInterval(function(){a.swipeNext()},a.params.autoPlay))};a.stopAutoPlay=function(){v&&clearInterval(v)};a.params.autoPlay&&a.startAutoPlay();a.container[0].addEventListener(E,y,!1);var s=a.isSupportTouch()?a.container[0]:document;s.addEventListener(F,z,!1);s.addEventListener(G,A,!1);a.destroy=function(){a.container[0].removeEventListener(E,y,false);s.removeEventListener(F,z,false);s.removeEventListener(G,A,false);window.removeEventListener("resize",x,false)};k({x:0,y:0,z:0},!0);a.swipeNext=function(c){a.inf&&c!="internal"&&t();if(e()){c=Math.ceil(j().y/90)*90-90;k({y:c},true,true,"next");a.rotates.currentY=c}else{c=Math.ceil(j().x/90)==j().x/90?90:0;c=Math.ceil(j().x/90)*90+c;k({x:c},true,true,"next");a.rotates.currentX=c}C();q(a.params.speed);if(b.onSlideChangeStart)b.onSlideChangeStart(a);b.onSlideChangeEnd&&B(b.onSlideChangeEnd)};a.swipePrev=function(c){a.inf&&c!="internal"&&t();if(e()){c=Math.floor(j().y/90)*90+90;k({y:c},true,true,"prev");a.rotates.currentY=c}else{c=Math.ceil(j().x/90)==j().x/90?-90:0;c=Math.floor(j().x/90)*90+c;k({x:c},true,true,"prev");a.rotates.currentX=c}C();q(a.params.speed);if(b.onSlideChangeStart)b.onSlideChangeStart(a);b.onSlideChangeEnd&&B(b.onSlideChangeEnd)};return a}}})(window.jQuery||window.Zepto);